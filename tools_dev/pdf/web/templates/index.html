<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compresseur PDF Local</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f4f4f9; color: #333; padding: 20px; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #2c3e50; margin-bottom: 30px; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #555; }
        input[type="text"], input[type="date"], input[type="datetime-local"], select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        input[type="file"] { padding: 10px 0; }
        button { width: 100%; background-color: #27ae60; color: white; padding: 12px; border: none; border-radius: 4px; font-size: 16px; cursor: pointer; transition: background 0.3s; }
        button:hover { background-color: #219150; }
        .hint { font-size: 0.8em; color: #777; margin-top: 5px; }
        .divider { border-top: 1px solid #eee; margin: 25px 0; }
        .loading { display: none; text-align: center; margin-top: 10px; color: #e67e22; font-weight: bold;}
    </style>
</head>
<body>

<div class="container">
    <h1>Compresseur PDF Local</h1>

    <form action="/compress" method="post" enctype="multipart/form-data" id="pdfForm">

        <div class="form-group">
            <label for="file">Fichier PDF</label>
            <input type="file" name="file" id="file" accept=".pdf" required>
        </div>

        <div class="form-group">
            <label for="compression_level">Niveau de compression</label>
            <select name="compression_level" id="compression_level">
                <option value="1">Prepress (Haute qualité)</option>
                <option value="2" selected>Printer (Recommandé - Bon ratio)</option>
                <option value="3">Ebook (Fichier léger)</option>
                <option value="4">Screen (Qualité basse)</option>
            </select>
        </div>

        <div class="divider"></div>
        <h3>Métadonnées</h3>

        <div class="form-group">
            <label for="author">Auteur</label>
            <input type="text" name="author" id="author" placeholder="Ex: Yann ILAS">
        </div>

        <div class="form-group">
            <label for="title">Titre</label>
            <input type="text" name="title" id="title" placeholder="Laissé vide = Nom du fichier">
            <p class="hint">Sera rempli automatiquement lors du choix du fichier.</p>
        </div>

        <div class="form-group">
            <label for="subject">Sujet</label>
            <input type="text" name="subject" id="subject" placeholder="Sujet ou Mots-clés">
        </div>

        <div class="form-group">
            <label for="created_date">Date de création</label>
            <input type="date" name="created_date" id="created_date">
        </div>

        <div class="form-group">
            <label for="modified_date">Date de modification</label>
            <input type="datetime-local" name="modified_date" id="modified_date">
        </div>

        <button type="submit" id="submitBtn">Compresser et Télécharger</button>
        <div class="loading" id="loadingMsg">Traitement en cours...</div>
    </form>
</div>

<script>
    // Liste des champs à sauvegarder (J'ai retiré 'title' car il change à chaque fichier)
    const persistentFields = ['compression_level', 'author', 'subject', 'created_date', 'modified_date'];

    // 1. Au chargement : Restaurer les valeurs
    document.addEventListener('DOMContentLoaded', () => {
        persistentFields.forEach(id => {
            const storedValue = localStorage.getItem('pdf_tool_' + id);
            if (storedValue) {
                document.getElementById(id).value = storedValue;
            }
        });
    });

    // 2. À chaque changement : Sauvegarder
    persistentFields.forEach(id => {
        const element = document.getElementById(id);
        element.addEventListener('input', (e) => {
            localStorage.setItem('pdf_tool_' + id, e.target.value);
        });
    });

    // 3. AUTO-REMPLISSAGE DU TITRE
    document.getElementById('file').addEventListener('change', function(e) {
        if (e.target.files.length > 0) {
            const fileName = e.target.files[0].name;
            // On retire l'extension .pdf
            const title = fileName.replace(/\.[^/.]+$/, "");

            // On remplit le champ titre (l'utilisateur peut le modifier ensuite)
            document.getElementById('title').value = title;
        }
    });

    // Loading effect
    document.getElementById('pdfForm').addEventListener('submit', () => {
        document.getElementById('submitBtn').disabled = true;
        document.getElementById('submitBtn').style.opacity = "0.7";
        document.getElementById('loadingMsg').style.display = 'block';
        setTimeout(() => {
            document.getElementById('submitBtn').disabled = false;
            document.getElementById('submitBtn').style.opacity = "1";
            document.getElementById('loadingMsg').style.display = 'none';
        }, 3000);
    });
</script>

</body>
</html>
